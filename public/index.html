<html>
  <head>
    <title>Express</title>
    <!-- Latest compiled and minified CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
      integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
      crossorigin="anonymous"
    />

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
      integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
      crossorigin="anonymous"
    ></script>

    <link rel="stylesheet" href="/stylesheets/style.css" />
  </head>

  <body>
    <h1>DATA TODO</h1>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Title</th>
          <th>Complete</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div
      class="modal fade"
      id="formModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <form id="form-todo">
            <div class="modal-header">
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
              <h4 class="modal-title" id="exampleModalLabel">New TODO</h4>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label for="title" class="control-label">Title:</label>
                <input
                  type="text"
                  class="form-control"
                  id="title"
                  name="title"
                />
              </div>
              <div class="form-group">
                <label for="complete" class="control-label">Complete:</label>
                <select class="form-control" id="complete" name="complete">
                  <option value="false">Not Done</option>
                  <option value="true">Done</option>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-default"
                data-dismiss="modal"
              >
                Close
              </button>
              <button type="submit" class="btn btn-primary">Save</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <button id="add-btn" class="btn btn-primary">Add</button>

    <script>
      $(document).ready(function () {
        loadData();
        setInterval(loadData, 1000)

        $("#add-btn").click(function () {
          $("#formModal").modal("show");
        });

        $("#form-todo").submit(function (event) {
          event.preventDefault();
          const value = $(this).serializeArray(); // jquery get value from form-todo
          const params = {};
          value.forEach((item) => {
            params[item.name] = item.value;
          });
          addData(params);
          $("#formModal").modal("hide");
        });
      });

      const loadData = () => {
        $.ajax({
          url: "http://localhost:3000/todo",
          method: "GET",
          dataType: "json",
        }).done(function (result) {
          let html = "";
          result.forEach((element) => {
            html += `
              <tr>
                <td>${element.title}</td>
                <td>${element.complete ? "sudah" : "belum"}</td>
              </tr>
            `;
          });
          $("table tbody").html(html);
        });
      };

      const addData = (value) => {
        $.ajax({
          url: "http://localhost:3000/todo",
          method: "POST",
          dataType: "json",
          data: value,
        }).done(function (result) {
          loadData;
        });
      };
    </script>
  </body>
</html>
